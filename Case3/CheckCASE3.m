clear all;clc
% Cabrera Kunjur MUMSA IOA
X=[3.05787800	1.87966000	4.45377200	4.04043500
0.23780300	0.27485300	0.29705700	0.24521600
4.82895400	1.18025300	3.91309500	6.38294000
2.05645600	2.13820900	0.84937200	2.62053200
0.76703800	-0.83359200	-2.06733800	1.13910600
1.85082800	-0.37877000	1.66106260	1.86610900
1.77680800	1.13206200	-1.30924300	1.89180500
-0.64199100	0.66343300	2.80696400	-0.76133900
1.00216800	4.35422400	2.73873590	1.18775100
0.22618600	2.55862500	4.85354300	0.00000000
];
for j=1:size(X,2)
x=X(:,j);
CD=[0.5, 1.1;    0.4, 1.1;    0.3, 1.1;    0.2, 1.0;    
    0.1, 0.9;    0.05, 0.75;    0.02, 0.6;    
    0.0, 0.5;    0.0, 0.4;    0.03, 0.3;    
    0.1, 0.25;    0.15, 0.2;    0.2, 0.3;    
    0.3, 0.4;    0.4, 0.5;    0.5, 0.7;    
    0.6, 0.9;    0.6, 1.0];
% Quy dao cho truoc
CD=CD';
% ==========================
Cdx=CD(1,:); Cdy=CD(2,:);
% ==========================
r1=x(1); r2=x(2);
r3=x(3); r4=x(4);
rcx=x(5); rcy=x(6);
f=0;
% teta2=x(10);
for i=1:length(Cdx);
    % teta3
    teta2=x(10)+(i-1)*(pi/9);
    K1=r1/r2;
    K4=r1/r3;
    K5=(r4^2-r1^2-r2^2-r3^2)/(2*r3*r2);
    D=cos(teta2)-K1+K4*cos(teta2)+K5;
    E=-2*sin(teta2);
    F=K1+(K4-1)*cos(teta2)+K5;
    ATAN3=(-E-sqrt(E^2-4*D*F))/(2*D);
    teta3=real(2*atan(ATAN3));
    Crx=r2*cos(teta2)+rcx*cos(teta3)-rcy*sin(teta3);
    Cry=r2*sin(teta2)+rcx*sin(teta3)+rcy*cos(teta3);
    C(:,i)=[cos(x(9)),-sin(x(9));sin(x(9)),cos(x(9))]*[Crx;Cry]+[x(7);x(8)];
    f=f+sum((C(:,i)-[Cdx(i);Cdy(i)]).^2);
end
x=[x;f];
DATA(:,j)=x;
end